<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />

    <title>AHS INV - Login</title>

    <!-- Custom fonts for this template-->
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet" />

    <!-- Custom styles for this template-->
    <link href="css/sb-admin-2.min.css" rel="stylesheet" />
  </head>

  <body class="bg-gradient-primary bg-dark">
    <div class="container h-100">
      <!-- Outer Row -->
      <div class="row justify-content-center">
        <div class="col-xl-5 col-lg-6 col-md-9">
          <div class="card o-hidden border-0 shadow-lg my-5">
            <div class="card-body p-0">
              <div class="p-5">
                <div class="text-center">
                  <h1 class="h4 text-gray-900 mb-4">Welcome to the <br />AHS Invitational!</h1>
                </div>
                <form class="user">
                  <div class="form-group">
                    <input type="text" name="username" class="form-control form-control-user" id="inputUsername" placeholder="Username" />
                  </div>
                  <div class="form-group">
                    <input type="password" name="password" class="form-control form-control-user" id="inputPassword" placeholder="Password" />
                  </div>
                  <div class="form-group">
                    <div class="custom-control custom-checkbox small">
                      <input type="checkbox" class="custom-control-input" id="customCheck" />
                      <label class="custom-control-label" for="customCheck">Remember Me</label>
                    </div>
                  </div>
                  <button id="formSubmit" type="submit" class="btn btn-primary btn-user btn-block">Login</button>
                </form>
              </div>
              <div id="invalidAlert" class="alert alert-danger ml-5 mr-5 mb-5">Invalid Password or Username</div>
              <div id="badRequestAlert" class="alert alert-danger ml-5 mr-5 mb-5">Bad Request</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>

  <script>
    const invalidAlert = document.getElementById("invalidAlert");
    const badRequestAlert = document.getElementById("badRequestAlert");
    invalidAlert.style.display = "none";
    badRequestAlert.style.display = "none";

    const submitButton = document.getElementById("formSubmit");
    submitButton.onclick = async (evt) => {
      evt.preventDefault();
      const username = submitButton.form.username.value;
      const password = submitButton.form.password.value;
      console.log(username, password);

      if (!username || !password) {
        return;
      }

      invalidAlert.style.display = "none";
      badRequestAlert.style.display = "none";

      const response = await fetch(location.protocol + "//" + location.host + "/login", {
        method: "POST",
        body: JSON.stringify({ username: username, password: password }),
        headers: {
          "Content-type": "application/json; charset=UTF-8",
        },
      });
      console.log(response);
      if (response.ok) {
        window.location.replace(location.protocol + "//" + location.host + "/home");
      } else {
        switch (response.status) {
          case 404:
            console.log("user not found");
            invalidAlert.style.display = "flex";
            break;
          case 401:
            console.log("invalid login");
            invalidAlert.style.display = "";
            break;
          case 400:
            console.log("bad request");
            badRequestAlert.style.display = "";
            break;
          default:
            break;
        }
      }
    };
  </script>

  <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
  <script src="/js/socket.js"></script>
</html>
